<!doctype html>
<html lang="en-GB">
<head>
  <meta charset="utf-8">
  <style>
    body {
      background: #fafafa;
    }
  </style>
</head>
<body>
  <div id="demo"></div>

  <script type="module">
    import { html, render } from 'lit';
    import '../index.js';

    let chart = JSON.stringify({
      header: "Student Grades",
      width: "500",
      height: "300"
    });
    const axis = JSON.stringify({
      xTitle: "Grades",
      yTitle: "Number of Students",
      yTicks: 10,
      yMin: 0,
      yMax: 54
    });
    let column = JSON.stringify({
      data: [0, 0, 1, 3, 10, 22, 53, 38, 27, 15],
      style: {
        fill: "car(--d2l-color-celestine)",
        stroke: "var(--d2l-color-celestine)",
        spacing: 10,
        minHeight: 2}
    });
    const categories = JSON.stringify({
      labels: ["0", "10", "20", "30", "40", "50", "60", "70", "80", "90"]
    });

    const handlePointClick = ({detail: {x, y}}) => console.log("Clicked a point", x, y);

    const updateData = (e) => {
      console.log(e.target.value);
      column = JSON.stringify({
        data: e.target.value.split(',').map(v => Number(v))
      });
      renderPage();
    }

    const updateWidth = (e) => {
      const newChart = JSON.parse(chart);
      newChart.width = e.target.value;
      chart = JSON.stringify(newChart);
      renderPage();
    }

    const updateHeight = (e) => {
      const newChart = JSON.parse(chart);
      newChart.height = e.target.value;
      chart = JSON.stringify(newChart);
      renderPage();
    }

    const renderPage = () => render(
      html`
        <bar-chart
          @composite-chart-point-click="${handlePointClick}"
          chart='${chart}'
          axis='${axis}'
          column='${column}'
          categories='${categories}'
        >
        </bar-chart>
        Data: <input .value="${JSON.parse(column).data.toString()}" @blur=${updateData}></input> <br>
        Width: <input .value="${JSON.parse(chart).width.toString()}" @blur=${updateWidth}></input> <br>
        Height: <input .value="${JSON.parse(chart).height.toString()}" @blur=${updateHeight}></input>
      `,
      document.querySelector('#demo')
    );
    renderPage();
  </script>
</body>
</html>
